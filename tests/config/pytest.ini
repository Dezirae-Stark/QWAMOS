[pytest]
# QWAMOS pytest configuration

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests/unit tests/integration

# Output options
addopts =
    # Verbose output
    -v
    # Show local variables in tracebacks
    -l
    # Show summary of all test outcomes
    -ra
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Strict config (fail on unknown config options)
    --strict-config
    # Show warnings
    -W default
    # Coverage options
    --cov=tests
    --cov-report=html:tests/coverage/html
    --cov-report=xml:tests/coverage/coverage.xml
    --cov-report=term-missing
    # Fail if coverage is below threshold
    --cov-fail-under=80
    # Color output
    --color=yes
    # Show durations of slowest tests
    --durations=10

# Markers for categorizing tests
markers =
    unit: Unit tests for individual components
    integration: Integration tests for system interactions
    crypto: Cryptography tests (Kyber, ChaCha20, etc.)
    gateway: Gateway tests (Tor, I2P, DNSCrypt, VPN)
    vm: Virtual machine and container tests
    storage: Storage and encryption tests
    network: Network routing tests
    slow: Tests that take a long time to run
    requires_qemu: Tests that require QEMU
    requires_kvm: Tests that require KVM support
    requires_network: Tests that require network access

# Minimum Python version
minversion = 3.8

# Consider these paths for test discovery
pythonpath = .

# Ignore paths
norecursedirs =
    .git
    .tox
    dist
    build
    *.egg
    __pycache__
    .venv
    venv
    android
    docs

# Console output style
console_output_style = progress

# Log settings
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Timeout for tests (in seconds)
timeout = 300
timeout_method = thread

# Warnings
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning

# Coverage options
[coverage:run]
source = tests
omit =
    */tests/config/*
    */tests/__pycache__/*
    */__init__.py
    */setup.py

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

[coverage:html]
directory = tests/coverage/html

[coverage:xml]
output = tests/coverage/coverage.xml
